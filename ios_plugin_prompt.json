{
  "prompt": "目的：实现 iOS 端 H5 插件，复刻 Android BreezeH5 功能（离线包+增量更新+路由重写+兜底）。Android 源码参考：https://github.com/jom-io/breeze-android\n\nAndroid 行为（需对齐）：\n- 入口优先本地：WebView 加载 https://appassets.androidplatform.net/<project>/vX/index.html，资源由 InternalStoragePathHandler 提供，根目录 files/<project>/vX/。\n- 种子：assets/<assetBasePath>/vN/dict.zip 中最高版本为种子，解压到 files/<project>/vN/ 并记为 active；若无则 seedVersion。\n- 版本管理：activeVersion 优先，其次本地最高版本；localIndexUrl = https://appassets.androidplatform.net/<project>/vX/index.html。\n- 路由重写：当入口来自本地包时，命中 remoteDomains（及 routePrefixes 可选）将远端 URL 改写到本地入口，保留 hash/query。\n- appassets 补全：对 appassets.androidplatform.net 请求补齐 /<project>/vX/ 前缀，缺失的 .ico 返回空响应兜底。\n- 更新：lastversion -> manifest(version,url,hash,size) -> 下载 zip -> 校验 sha256/size -> 解压 -> 清理旧版本 keepVersions；若回调 onVersionReady 返回 true 立即激活。\n- 定时：初始延迟 initialCheckDelayMillis，失败指数退避（*backoffMultiplier，夹在 min/max），Wi-Fi Only 可跳过检查；enablePeriodicCheck 可关闭。\n- 兜底：无本地或加载错误则 fallbackUrl；fallback 环境不再重写远端域名。\n- 配置字段：projectName/baseUrl/fallbackUrl/remoteDomains/routePrefixes/assetBasePath/assetZipName/lastVersionPath/manifestPattern/seedVersion/initialCheckDelayMillis/minCheckIntervalMillis/maxCheckIntervalMillis/backoffMultiplier/enablePeriodicCheck/keepVersions/useWifiOnly。\n- 打包：package-h5.sh 生成 release/dev/vN/dict.zip + manifest.json + lastversion（默认 BASE_URL= https://xxx/xxx，BUILD_DIR=dist，OUT_DIR=release/dev，KEEP_PREVIOUS=true）。\n\niOS 插件实现提示（Swift 5+ / WKWebView）：\n- 提供与 Android 对齐的配置结构体 H5Config，默认值同上；支持切换配置 switchConfig / reset 计时。\n- 存储：使用 Application Support 或 Caches 下 <project>/vX/（确保 Do Not Backup）；activeVersion 持久化到 UserDefaults。\n- 种子：从主 Bundle 读取 assetBasePath/vN/dict.zip，取最高 vN 解压为种子，失败则使用 seedVersion。\n- 资源加载：使用 WKURLSchemeHandler 挂载自定义 scheme（如 appassets）映射到本地文件；在导航/拦截中把 https://appassets.androidplatform.net/... 重写为自定义 scheme 请求以实现同域访问。需保证路径补全 /<project>/vX/ 与 .ico 兜底。\n- WebView 集成：提供 attachWebView(webView) 设置 navigationDelegate/URLSchemeHandler；提供 loadEntry(webView) 按 bestLocalIndexUrl 或 fallbackUrl 加载。\n- 路由重写：当入口来自本地包时，navigationDelegate 中对 remoteDomains（及 routePrefixes 命中时）将跳转改写为本地入口并保留 hash/query。\n- 更新：checkForUpdates() 使用 URLSession 访问 lastversion/manifest；下载 zip（支持重定向）；校验 sha256/size；解压（可用 ZIPFoundation 或系统 API）；完成后清理旧版本 keepVersions；回调 onVersionReady(version:url) 决定是否立即设为 active。\n- 定时：使用 Timer/DispatchSource 定时器，初始延迟 initialCheckDelayMillis，指数退避；enablePeriodicCheck=false 时仅手动；app 恢复前台时 onHostResume 重置定时。\n- 网络限制：useWifiOnly 时可用 NWPathMonitor 只在 Wi-Fi/以太网时发起更新。\n- API：resolveEntryUrl()/fallbackUrl()/activateVersion()/bestLocalVersion()/bestLocalIndexUrl()/mapToLocalIfPossible(url) 等接口与 Android 对齐，便于宿主使用。\n- 错误兜底：加载失败时尝试 fallbackUrl，否则回调 loadListener.onAllFailed(url, reason)。\n- 日志：提供统一 tag，记录版本选择、下载、校验、解压、路由重写、错误。\n- 兼容已有包：manifest.json 字段 version/url/hash/size，lastversion 可为 JSON {\\\"version\\\":N} 或纯数字/vN 字符串；本地包目录结构与安卓保持一致（vN/index.html、静态资源）。\n- 安全：不要硬编码真实地址，默认 BASE_URL 用占位 https://xxx/xxx。\n-\n输出：按以上提示编写 iOS 插件（Swift 首选，可封装为 CocoaPods/SPM 库），确保功能与 Android BreezeH5 等效。",
  "notes": "使用时将 <project>/<env> 等替换为实际项目名/环境；如需自定义域名或 scheme，可在 prompt 中说明。"
}
